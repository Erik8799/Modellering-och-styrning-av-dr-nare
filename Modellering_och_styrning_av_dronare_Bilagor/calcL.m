clc;
clear all;
close all;

rad2deg = 180/pi;
deg2rad = pi/180;

%define constants
m = 30.3e-3;
mp = 0.3e-3;
g = 9.82;
l = (9.221e-2)/2;

J = [1.5963e-5 0         0;
     0         1.5914e-5 0;
     0         0         3.0583e-5];

J_x = J(1,1);
J_y = J(2,2);
J_z = J(3,3);
J_p = mp*((4.2e-2)^2+(0.84e-2)^2)/12;

k = 1.946e-8;
d = 7.905e-10;

psi = 0*deg2rad; %0,30,...,330 degrees

[A,B] = modell(psi,m,l,J_x,J_y,J_z,J_p,k,d);

A2 = [1 0 0 0 0 0;
      0 1 0 0 0 0;
      0 0 1 0 0 0;
      0 0 0 0 0 1];

Atot = [ A  zeros(12,4);
        A2  zeros(4,10)];
Btot = [B; zeros(4,4)];

%mode 1 change of coordinate
Q = [1000000 0 0 0 0 0 0 0 0 0 0 0;
     0 1000000 0 0 0 0 0 0 0 0 0 0;
     0 0 1000000000 0 0 0 0 0 0 0 0 0;
     0 0 0 0 0 0 0 0 0 0 0 0;
     0 0 0 0 0 0 0 0 0 0 0 0;
     0 0 0 0 0 10000000 0 0 0 0 0 0;
     0 0 0 0 0 0 120000 0 0 0 0 0;
     0 0 0 0 0 0 0 120000 0 0 0 0;
     0 0 0 0 0 0 0 0 50000 0 0 0;
     0 0 0 0 0 0 0 0 0 0 0 0;
     0 0 0 0 0 0 0 0 0 0 0 0;
     0 0 0 0 0 0 0 0 0 0 0 0];
Q2 = [1 0 0 0;
      0 1 0 0;
      0 0 100000000 0;
      0 0 0 5000];
Qtot = [          Q  zeros(12,4);
        zeros(4,12)           Q2];
R = 0.0002*eye(4);

%mode 2 hover
% Q = [10000 0 0 0 0 0 0 0 0 0 0 0;
%      0 10000 0 0 0 0 0 0 0 0 0 0;
%      0 0 1000000 0 0 0 0 0 0 0 0 0;
%      0 0 0 0 0 0 0 0 0 0 0 0;
%      0 0 0 0 0 0 0 0 0 0 0 0;
%      0 0 0 0 0 1000000 0 0 0 0 0 0;
%      0 0 0 0 0 0 10000 0 0 0 0 0;
%      0 0 0 0 0 0 0 10000 0 0 0 0;
%      0 0 0 0 0 0 0 0 100 0 0 0;
%      0 0 0 0 0 0 0 0 0 0 0 0;
%      0 0 0 0 0 0 0 0 0 0 0 0;
%      0 0 0 0 0 0 0 0 0 0 0 0];
% Q2 = [1000 0 0 0;
%       0 1000 0 0;
%       0 0 600000000 0;
%       0 0 0 5000];
% Qtot = [          Q  zeros(12,4);
%         zeros(4,12)           Q2];
% R = 0.00001*eye(4);

L = lqr(Atot,Btot,Qtot,R,0);